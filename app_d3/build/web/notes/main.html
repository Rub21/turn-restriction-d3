<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <style>
        #tooltip {
            position: absolute;
            width: 50px;
            height: auto;
            padding: 10px;
            background-color: white;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            pointer-events: none;
        }
        #tooltip.hidden {
            display: none;
        }
        #tooltip p {
            margin: 0;
            font-family: sans-serif;
            font-size: 12px;
            line-height: 16px;
        }
        .indent{
            padding-left: 5px;
        }

        rect {
            -moz-transition: all 0.3s;
            -webkit-transition: all 0.3s;
            -o-transition: all 0.3s;
            transition: all 0.3s;
        }
        rect:hover{
            fill: orange;
        }
        .axis path,
        .axis line {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }
        .axis text {
            font-family: sans-serif;
            font-size: 11px;
        }

    </style>
</head>

<body>
    <div id="estadisticas"></div>
    <script src="http://d3js.org/d3.v3.min.js"></script>

    <script>

        var margin = {top: 25, right: 40, bottom: 35, left: 85},
        w = 900 - margin.left - margin.right,
                h = 500 - margin.top - margin.bottom;
        var padding = 10;

        var colors = {0: ["Open", "#377EB8"],
            1: ["Closed", "#4DAF4A"]};

        var dataset = [
            {"date": " 2013-04 ", "open": 100, "closed": 768},
            {"date": " 2013-05 ", "open": 630, "closed": 3701},
            {"date": " 2013-06 ", "open": 872, "closed": 4563},
            {"date": " 2013-07 ", "open": 1474, "closed": 7364},
            {"date": " 2013-08 ", "open": 2447, "closed": 12574},
            {"date": " 2013-09 ", "open": 2627, "closed": 13062},
            {"date": " 2013-10 ", "open": 3220, "closed": 12802},
            {"date": " 2013-11 ", "open": 3671, "closed": 10872},
            {"date": " 2013-12 ", "open": 3582, "closed": 9190},
            {"date": " 2014-01 ", "open": 5182, "closed": 11535},
            {"date": " 2014-02 ", "open": 4460, "closed": 11034},
            {"date": " 2014-03 ", "open": 5971, "closed": 11029},
            {"date": " 2014-04 ", "open": 6105, "closed": 10881},
            {"date": " 2014-05 ", "open": 7538, "closed": 9405},
            {"date": " 2014-06 ", "open": 7992, "closed": 6896},
            {"date": " 2014-07 ", "open": 887, "closed": 377}

            /*
             {"keyword": "payday loans", "global": 1400000, "local": 673000, "cpc": "14.11"},
             {"keyword": "title loans", "global": 165000, "local": 160000, "cpc": "12.53"},
             {"keyword": "personal loans", "global": 550000, "local": 301000, "cpc": "6.14"},
             {"keyword": "online personal loans", "global": 15400, "local": 12900, "cpc": "5.84"},
             {"keyword": "online title loans", "global": 111600, "local": 11500, "cpc": "11.74"}*/
        ];




        var xScale = d3.scale.ordinal()
                .domain(d3.range(dataset.length))
                .rangeRoundBands([0, w], 0.1);
        
        
        
// ternary operator to determine if global or local has a larger scale
        var yScale = d3.scale.linear()
                .domain([0, d3.max(dataset, function(d) {
                        return (d.open > d.closed) ? d.open : d.closed;
                    })])
                .range([h, 0]);
        
        
        var xAxis = d3.svg.axis()
                .scale(xScale)
                .orient("bottom");
        var yAxis = d3.svg.axis()
                .scale(yScale)
                .orient("left")
                .ticks(5);

        var closed = function(d) {
            return d.closed;
        };
 /*       var cpc = function(d) {
            return d.cpc;
        };*/

        var commaFormat = d3.format(',');

//SVG element
        var svg = d3.select("#estadisticas")
                .append("svg")
                .attr("width", w + margin.left + margin.right)
                .attr("height", h + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// Graph Bars
        var sets = svg.selectAll(".set")
                .data(dataset)
                .enter()
                .append("g")
                .attr("class", "set")
                .attr("transform", function(d, i) {
                    return "translate(" + xScale(i) + ",0)";
                })
                ;

        sets.append("rect")
                .attr("class", "local")
                .attr("width", xScale.rangeBand() / 2)
                .attr("y", function(d) {
                    return yScale(d.open);
                })
                .attr("x", xScale.rangeBand() / 2)
                .attr("height", function(d) {
                    return h - yScale(d.open);
                })
                .attr("fill", colors[0][1])
                .append("text")
                .text(function(d) {
                    return commaFormat(d.open);
                })
                .attr("text-anchor", "middle")
                .attr("x", function(d, i) {
                    return xScale(i) + xScale.rangeBand() / 2;
                })
                .attr("y", function(d) {
                    return h - yScale(d.open) + 14;
                })
                .attr("font-family", "sans-serif")
                .attr("font-size", "11px")
                .attr("fill", "black")
                ;

        sets.append("rect")
                .attr("class", "global")
                .attr("width", xScale.rangeBand() / 2)
                .attr("y", function(d) {
                    return yScale(d.closed);
                })
                .attr("height", function(d) {
                    return h - yScale(d.closed);
                })
                .attr("fill", colors[1][1])
                .append("text")
                .text(function(d) {
                    return commaFormat(d.closed);
                })
                .attr("text-anchor", "middle")
                .attr("x", function(d, i) {
                    return xScale(i) + xScale.rangeBand() / 2;
                })
                .attr("y", function(d) {
                    return h - yScale(d.closed) + 14;
                })
                .attr("font-family", "sans-serif")
                .attr("font-size", "11px")
                .attr("fill", "red")
                ;

// xAxis
        svg.append("g") // Add the X Axis
                .attr("class", "x axis")
                .attr("transform", "translate(0," + (h) + ")")
                .call(xAxis)
                ;
// yAxis
        svg.append("g")
                .attr("class", "y axis")
                .attr("transform", "translate(0 ,0)")
                .call(yAxis)
                ;
// xAxis label
        svg.append("text")
                .attr("transform", "translate(" + (w / 2) + " ," + (h + margin.bottom - 5) + ")")
                .style("text-anchor", "middle")
                .text("Date");
//yAxis label
        svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (h / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Num Notes");

// Title
        svg.append("text")
                .attr("x", (w / 2))
                .attr("y", 0 - (margin.top / 2))
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("text-decoration", "underline")
                .text("Status of Notes in OSM");


// add legend   


            var legend = svg.selectAll(".legend")
                    .data(ageNames.slice().reverse())
                    .enter().append("g")
                    .attr("class", "legend")
                    .attr("transform", function(d, i) {
                        return "translate(0," + i * 20 + ")";
                    });


/*
        var legend = svg.append("g")
                .attr("class", "legend")
                //.attr("x", w - 65)
                //.attr("y", 50)
                .attr("height", 100)
                .attr("width", 100)
                .attr('transform', 'translate(-20,50)');


        legend.selectAll('rect')
                .data(dataset)
                .enter()
                .append("rect")
                .attr("x", w - 65)
                .attr("y", function(d, i) {
                    return i * 20;
                })
                .attr("width", 10)
                .attr("height", 10)
                .style("fill", function(d) {
                    var color = colors[dataset.indexOf(d)][1];
                    return color;
                });

        legend.selectAll('text')
                .data(dataset)
                .enter()
                .append("text")
                .attr("x", w - 52)
                .attr("y", function(d, i) {
                    return i * 20 + 9;
                })
                .text(function(d) {
                    var text = colors[dataset.indexOf(d)][0];
                    return text;
                });*/
    </script>

</body>